<div class="ranWrapper">
	<div class="hoverrerr"></div>

	<nav>
		<ul>
			<li class="cpunc">cpunc</li>
			<li class="infra">infra</li>
			<li class="oldNY">old new york</li>
			<li class="bott">bottanicals</li>
		</ul>
	</nav>

	<div class="randomImage"></div>
</div>

<script>
	let nextColl = "2598205";
	let reset = false;

	const imgHldr = $(".randomImage");

	let theAni = async plugColl => {
		// Adding a random number to the URL ensures that
		// a new, random image is pulled. Otherwise it just
		// pulls the same image every time
		//
		let ranNum = new Date().getTime();

		console.log("");
		console.log("collection: " + plugColl);

		// Fetch the image from Unsplash using on(load).
		// This allows the image to fully load before
		// fading in and onto the stage
		//
		// Execute looping by recurssively calling theAni()
		//
		var imgFetch = await $("<img />")
			.attr(
				"src",
				"https://source.unsplash.com/collection/" +
					plugColl +
					"/3840x2160?" +
					ranNum
			)
			.on("load", function() {
				if (
					!this.complete ||
					typeof this.naturalWidth == "undefined" ||
					this.naturalWidth == 0
				) {
					console.log("busted image!");
				} else {
					let theImgUrl = imgFetch.attr("src");
					console.log("theImgUrl: " + theImgUrl);
					imgHldr
						.css({ "background-image": "url(" + theImgUrl + ")" })

						// Animate dis bish.
						// Fade in, hold, fade out, rinse and repeat
						//
						.fadeIn(2000)
						.delay(12000)
						.fadeOut(2000)

						// Trigger the loop
						//
						.queue(function(next) {
							theAni(plugColl);
							next();
						});
				}
			});
	};

	let unsp = plugColl => {
		// Loop through current collection
		//
		if (reset === false) {
			theAni(plugColl);

			// Switch to new, selected collection
			//
		} else {
			console.log("NEW collection : " + plugColl);

			reset = false;

			// Restart the function with the new collection
			//
			theAni(plugColl);
		}
	};

	// Fade out current image +
	// Trigger new collection load
	//
	let swapper = nextColl => {
		imgHldr.fadeOut(2000, function() {
			unsp(nextColl);
		});
	};

	// Trigger the switch to the selected collection
	//
	$("li").click(function() {
		// Tell unsp() there's a new collection to load
		//
		reset = true;

		// Strip current animation chain and reinit via switch below.
		// Current image will fade out before running unsp()
		//
		imgHldr.stop().clearQueue();

		// ————— ACCOUNTS —————
		// https://unsplash.com/@nypl
		//
		//
		// ————— COLLECTIONS —————
		// https://unsplash.com/collections/3178572/winter
		// https://unsplash.com/collections/219941/architecture%2C-buildings%2C-spaces
		// https://unsplash.com/collections/3694365/gradient-nation
		//
		//
		// ————— MINE —————
		// https://unsplash.com/collections/2598205/cpunc
		// https://unsplash.com/collections/9736875/bott
		// https://unsplash.com/collections/9736914/old-new-york

		let swpColl = $(this).attr("class");
		switch (swpColl) {
			case "cpunc":
				console.log("swpColl: " + swpColl);

				swapper("2598205");
				break;

			case "infra":
				console.log("swpColl: " + swpColl);

				swapper("219941");
				break;

			case "oldNY":
				swapper("9736914");
				break;

			case "bott":
				swapper("9736875");
				break;

			default:
				unsp("2598205");
		}
	});

	// Init ... fire the fucker up
	//
	(function() {
		unsp("9736875");
	})();
</script>
